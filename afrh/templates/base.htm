{% load staticfiles %}
{% load i18n %}
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->  
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->  
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->  
{% if debug %}
<!--
<script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':{{ livereload_port }}/livereload.js?snipver=1"></' + 'script>')</script>
-->
{% endif %}

<head>
    <title>{% block title %}{{ APP_NAME }}{% endblock %}</title>

    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="{% static 'img/icons/favicon/favicon.ico' %}">

    {% block css %}
        <!--
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css">
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/octicons/2.1.2/octicons.min.css">
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/select2/3.5.0/select2-bootstrap.min.css" type="text/css">
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/3.1.3/css/bootstrap-datetimepicker.min.css" type="text/css" media="screen">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/blueimp-gallery/2.15.2/css/blueimp-gallery.min.css" type="text/css" media="screen">
        -->
        
        <link rel="stylesheet" href="{% static 'plugins/line-icons/line-icons.css' %}">
        <link rel="stylesheet" href="{% static 'css/main.css' %}">
        <link rel="stylesheet" href="{% static 'css/plugins/smartadmin-production.css' %}" type="text/css" media="screen">
        <link rel="stylesheet" href="{% static 'css/plugins/bootstrap-image-gallery.min.css' %}" type="text/css" media="screen">
        <link rel="stylesheet" href="{% static 'plugins/openlayers/ol.css' %}">
        <link rel="stylesheet" href="{% static 'css/arches.css' %}">
        <link rel="stylesheet" href="{% static 'css/package.css' %}">
        <!-- local versions of previously linked plugins -->
        <link rel="stylesheet" href="{% static 'css/plugins/bootstrap.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/plugins/font-awesome.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/plugins/octicons.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/plugins/select2-bootstrap.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/plugins/bootstrap-datetimepicker.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/plugins/blueimp-gallery.min.css' %}">
        
    {% endblock css%}

</head> 

<body class="scroll-y"> 

    <!-- The Bootstrap Image Gallery lightbox, should be a child element of the document body -->
<div id="blueimp-gallery" class="blueimp-gallery" data-use-bootstrap-modal="true">
    <!-- The container for the modal slides -->
    <div class="slides"></div>
    
    <!-- Controls for the borderless lightbox -->
    <h3 class="title"></h3>
    <a class="prev">‹</a>
    <a class="next">›</a>
    <a class="close">×</a>
    <a class="play-pause"></a>
    <ol class="indicator"></ol>
    
    <!-- The modal dialog, which will be used to wrap the lightbox content 
         (to use the model, toggle data-use-bootstrap-modal to "true" in #blueimp-gallery -->
    <div class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" aria-hidden="true">&times;</button>
                    <h4 class="modal-title"></h4>
                </div>
                <div class="modal-body next"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left prev">
                        <i class="fa fa-chevron-left"></i>
                        {% trans "Previous" %}
                    </button>
                    <button type="button" class="btn btn-primary next">
                        {% trans "Next" %}
                        <i class="fa fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="wrapper">
        {% block header %}
            {% include 'header.htm' %}
        {% endblock header %} 

        <!--{% block breadcrumbs %} -->
        <!--=== Breadcrumbs ===-->
<!--         <div class="breadcrumbs">
            <div class="container">

                <h1 class="pull-left arches-breadcrumb-title">Reference Data Manager (RDM)</h1>
                <ul class="pull-right breadcrumb">
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="">Reference Data Manager</a></li>
                </ul>
            </div>
        </div> -->
        <!--=== End Breadcrumbs ===-->
        <!-- {% endblock breadcrumbs %} -->

        {% block subheader %}
        {% endblock subheader %}

        <!--=== Content Part ===-->
        {% block content %}
        {% endblock content %}
        <!--=== End Content Part ===-->

        <!--=== Footer ===-->
        {% block footer %}
            {% include 'footer.htm' %}
        {% endblock footer %}
        <!--=== End Footer ===-->
    </div>
    <div>
        <!--=== Copyright ===-->
        {% block copyright %}
            {% include 'copyright.htm' %}
        {% endblock copyright %}
        <!--=== End Copyright ===-->

    </div><!--/wrapper-->

    {% block javascript %}
    <!--
    <script src="http://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.14/require.min.js"></script>
    
    
    <script src="{{ STATIC_URL }}js/plugins/require.min.js"></script>
    -->
    <script src="{% static 'js/plugins/require.min.js' %}"></script>
    
    
    
    {% block pre_require_js %}
    
    {% endblock pre_require_js %}
    
    <script>
        require.config({
            baseUrl: '{{ STATIC_URL }}js',
            paths: {
                'plugins': '{{ STATIC_URL }}plugins',
                'openlayers': '{{ STATIC_URL }}plugins/openlayers/ol',
                
                //local paths
                'async': '{{ STATIC_URL }}js/plugins/async',
                'jquery': '{{ STATIC_URL }}js/plugins/jquery.min',
                'select2': '{{ STATIC_URL }}js/plugins/select2.min',
                'bootstrap': '{{ STATIC_URL }}js/plugins/bootstrap.min',
                'jquery-ui': '{{ STATIC_URL }}js/plugins/jquery-ui.min',
                'flexslider': '{{ STATIC_URL }}js/plugins/jquery.flexslider-min',
                'easing': '{{ STATIC_URL }}js/plugins/jquery.easing.min',
                'backbone': '{{ STATIC_URL }}js/plugins/backbone-min',
                'underscore': '{{ STATIC_URL }}js/plugins/underscore-min',
                'jquery-validate': '{{ STATIC_URL }}js/plugins/jquery.validate.min',
                'd3': '{{ STATIC_URL }}js/plugins/d3.min',
                'dropzone': '{{ STATIC_URL }}js/plugins/dropzone-amd-module.min',
                'summernote': '{{ STATIC_URL }}js/plugins/summernote.min',
                'knockout': '{{ STATIC_URL }}js/plugins/knockout/3.3.0/knockout-min',
                'knockout-mapping': '{{ STATIC_URL }}js/plugins/knockout.mapping.min',
                'moment': '{{ STATIC_URL }}js/plugins/moment.min',
                'bootstrap-datetimepicker': '{{ STATIC_URL }}js/plugins/bootstrap-datetimepicker.min',
                'shp': '{{ STATIC_URL }}js/plugins/shapefile',
                'blueimp-gallery': '{{ STATIC_URL }}js/plugins/blueimp-gallery',
                'blueimp-jquery': '{{ STATIC_URL }}js/plugins/jquery.blueimp-gallery',
                'blueimp-helper': '{{ STATIC_URL }}js/plugins/blueimp-helper.min',
                
                <!-- remote paths -->
                //'async': 'http://cdnjs.cloudflare.com/ajax/libs/requirejs-async/0.1.1/async',
                //'jquery': 'http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min',
                //'select2': 'http://cdnjs.cloudflare.com/ajax/libs/select2/3.5.1/select2.min',
                //'bootstrap': 'http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.0/js/bootstrap.min',
                //'jquery-ui': 'http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min',
                //'flexslider': 'http://cdnjs.cloudflare.com/ajax/libs/flexslider/2.2.2/jquery.flexslider-min',
                //'easing': 'http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min',
                //'backbone': 'http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min',
                //'underscore': 'http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min',
                //'jquery-validate': 'http://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.11.1/jquery.validate.min',
                //'d3': 'http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min',
                //'dropzone': 'http://cdnjs.cloudflare.com/ajax/libs/dropzone/3.8.4/dropzone-amd-module.min',
                //'summernote': 'http://cdnjs.cloudflare.com/ajax/libs/summernote/0.5.10/summernote.min',
                //'knockout': 'http://cdnjs.cloudflare.com/ajax/libs/knockout/3.2.0/knockout-min',
                ////'knockout': 'http://knockoutjs.com/downloads/knockout-3.2.0.debug',
                //'knockout-mapping': 'http://cdnjs.cloudflare.com/ajax/libs/knockout.mapping/2.4.1/knockout.mapping.min',
                //'moment': 'http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min',
                //'bootstrap-datetimepicker': 'http://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/3.1.3/js/bootstrap-datetimepicker.min',
                //'shp': 'https://raw.githubusercontent.com/wavded/js-shapefile-to-geojson/master/shapefile',
                //'blueimp-gallery': 'https://cdnjs.cloudflare.com/ajax/libs/blueimp-gallery/2.15.2/js/blueimp-gallery',
                //'blueimp-jquery': 'http://blueimp.github.io/Gallery/js/jquery.blueimp-gallery',
                //'blueimp-helper': 'https://cdnjs.cloudflare.com/ajax/libs/blueimp-gallery/2.15.2/js/blueimp-helper.min'
            },
            shim: {
                'openlayers': {
                    exports: 'ol'
                }
            }
            
        });
        
        // application wide require calls
        require(["jquery"], function($) {
            var jQuery = $;

            // put values here that should be accessible application wide
            define('arches', [], function () {
                return {
                    urls: {
                        home: "{% url 'home' %}",
                        media: "{{ STATIC_URL }}",
                        uploadedfiles: "{{ MEDIA_URL }}",
                        concept_tree: "{% url 'concept_tree' %}",
                        concept: "{% url 'concept' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}",
                        concept_search: "{% url 'concept_search' %}",
                        concept_manage_parents: "{% url 'concept_manage_parents' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}",
                        from_sparql_endpoint: "{% url 'from_sparql_endpoint' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}",
                        search_sparql_endpoint: "{% url 'search_sparql_endpoint' %}",
                        confirm_delete: "{% url 'confirm_delete' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}",
                        edit_history: "{% url 'edit_history' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}",
                        search_terms: "{% url 'search_terms' %}",
                        search_results: "{% url 'search_results' %}",
                        search_results_export: "{% url 'search_results_export' %}",
                        map_layers: "{% url 'map_layers' '' %}",
                        map_markers: "{% url 'map_markers' '' %}",
                        polygon_layers: "{% url 'polygon_layers' '' %}",
                        arch_layer: "{% url 'arch_layer' %}",
                        act_a_layer: "{% url 'act_a_layer' %}",
                        reports: "{% url 'report' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}".replace('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', ''),
                        buffer: "{% url 'buffer'%}",
                        related_resources: "{% url 'related_resources' 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa' %}".replace('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', '')
                    },
                    mapDefaults: {
                        x: {{ map_info.x }},
                        y: {{ map_info.y }},
                        zoom: {{ map_info.zoom }},
                        minZoom: {{ map_info.map_min_zoom }},
                        maxZoom: {{ map_info.map_max_zoom }},
                        extent: '{{ map_info.extent }}'
                    },
                    resourceMarker: {
                        font: '{{ map_info.resource_marker_font }}',
                        icon: '{{ map_info.resource_marker_icon }}',
                        defaultColor: '{{ map_info.resource_marker_color }}'
                    },
                    bingKey: "{{ map_info.bing_key }}",
                    bingLayers: [{
                        id: 'Road',
                        name: "{% trans 'Streets' %}",
                        icon: "{% static 'img/map/bing_streets.png' %}"
                    },
                    {
                        id: 'Aerial',
                        name: "{% trans 'Satellite' %}",
                        icon: "{% static 'img/map/bing_satellite.png' %}"
                    },
                    {
                        id: 'AerialWithLabels',
                        name: "{% trans 'Streets & Satellite' %}",
                        icon: "{% static 'img/map/bing_hybrid.png' %}"
                    }]
                };
            });
            
            define('browse-info', [], function () {
                var browseInfo = {
                    {% for node, entries in browse_info.items %}
                    "{{ node }}": {
                        {% for entry, contents in entries.items %}
                        "{{ entry }}": {
                            inverted: false,
                            type: "concept",
                            context: "{{ contents.context }}",
                            context_label: "",
                            id: "{{ contents.id }}",
                            text: "{{ contents.text }}",
                            value: "{{ contents.value }}",
                        },
                        {% endfor %}
                    },
                    {% endfor %}
                }
                return browseInfo;
            });
            

            define('resource-types', [], function () {
                var resourceTypes = {
                    {% for type, type_data in resource_types %}
                    "{{type}}": {
                        id: "{{type_data.resourcetypeid}}",
                        icon: "{{type_data.icon_class}}",
                        iconColor: "{{type_data.marker_color}}",
                        name: "{{type_data.name}}",
                        description: "{{type_data.description}}",
                        defaultDescription: "{{type_data.default_description}}",
                        descriptionNode: "{{type_data.description_node}}",
                        categories: [
                            {% for category in type_data.categories %}
                            "{{category}}"
                            {% endfor %}
                        ],
                        {% if type_data.has_layer %}
                        makeLayer: true,
                        {% else %}
                        makeLayer: false,
                        {% endif %}
                        {% if type_data.restricted %}
                        restricted: true,
                        {% else %}
                        restricted: false,
                        {% endif %}
                        layerModel: "{{type_data.layer_model}}",
                        color: "{{type_data.marker_color}}",
                        vectorColor: "{{type_data.marker_color}}",
                        fillColor: "{{ type_data.fill_color }}",
                        strokeColor: "{{ type_data.stroke_color }}",
                        infoContent: "{{ type_data.map_info }}"
                    },
                    {% endfor %}
                };
                return resourceTypes;
            });
            
            define('user-info', [], function () {
                var userinfo = {
                    'name':'{{user.username}}',
                    'create':{
                        {% for type, typedata in resource_types %}
                            {% if type in create %}
                            '{{type}}':true,
                            {% else %}
                            '{{type}}':false,
                            {% endif %}
                        {% endfor %}
                    },
                    'view':{
                        {% for type, typedata in resource_types %}
                            {% if type in view %}
                            '{{type}}':true,
                            {% else %}
                            '{{type}}':false,
                            {% endif %}
                        {% endfor %}
                    },
                    'edit':{
                        {% for type, typedata in resource_types %}
                            {% if type in edit %}
                            '{{type}}':true,
                            {% else %}
                            '{{type}}':false,
                            {% endif %}
                        {% endfor %}
                    },
                    'fullreport':{
                        {% for type, typedata in resource_types %}
                            {% if type in fullreport %}
                            '{{type}}':true,
                            {% else %}
                            '{{type}}':false,
                            {% endif %}
                        {% endfor %}
                    },
                };
                return userinfo;
            });
            

            require(["plugins/scroll-to-top", "views/simple-search", "bootstrap", "jquery-ui"], function (scrollToTop, SimpleSearch) {
                var search = new SimpleSearch({ el: $('#simple-search')[0] });                
                var scrollableElement;
                {% if active_page == 'ResourceReport' %}
                    scrollableElement = $('#report-body'); 
                {% endif %}

                scrollToTop.init(scrollableElement);
                // include all base_page instances here that page scripts may need access to
                // NOTE: this module should only ever be required from within main page scripts
                define('base_page', [], function () {
                    return {
                        search: search,
                        scrollToTop: scrollToTop
                    };
                });

                {% if main_script %}
                    // main page script require
                    require(["{{ main_script }}"]);
                {% endif %}

                $('[data-toggle="popover"]').popover();
            });
            
            $(".help-toggle").click(function (){ 
                iconEl = $(this).find('i');
                sectionEl = $(this).closest('.help-section');
                contentEl = $(sectionEl).find('.help-content');
                if (contentEl.is(":visible")){
                    contentEl.hide("fast");
                } else {
                    contentEl.show("fast");
                }
                $(iconEl).toggleClass("fa-chevron-down");
                $(iconEl).toggleClass("fa-chevron-right");
            });
            
            var help_on = false;
            function toggleHelp() {
                $("#help-button").click(function(){
                    if (help_on == true){
                        $("#help-section").slideUp();
                        $("#help-button").html("SHOW HELP");
                    } else {
                        $("#help-section").slideDown();
                        $("#help-button").html("HIDE HELP");
                    }
                    help_on = !help_on
                });
            };
            
            var c1 = "public.affairs";
            var c2 = "@";
            var c3 = "afrh.gov";
            var email = c1+c2+c3
            
            function fillErrorMessages() {
                $(".er-select").html('{% trans "You must make a selection." %}');
                $(".er-fill-both").html('{% trans "You must populate both fields." %}');
                $(".er-fill-single").html('{% trans "You must fill this field." %}');
                $(".er-fill-name").html('{% trans "You must enter a name." %}');
                $(".er-fill-all").html('{% trans "You must fill all fields." %}');
                $(".nr").html('{% trans "none recorded" %}');
                $(".er-fill-both-date").html('{% trans "You must populate both fields (date format: YYYY-MM-DD)." %}');
            }
            
            $(document).ready(function() {
                toggleHelp();
                document.getElementById('contact').textContent = email;
                document.getElementById('contact').href = "mailto:"+email;
                fillErrorMessages();
            });
            
            
            
            
        });
        
        
        
    </script>

    {% endblock javascript %}

    {% if GOOGLE_ANALYTICS_TRACKING_ID != None %}
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', '{{GOOGLE_ANALYTICS_TRACKING_ID}}', 'auto');
      ga('send', 'pageview');

    </script>
    {% endif %}
</body>

</html> 